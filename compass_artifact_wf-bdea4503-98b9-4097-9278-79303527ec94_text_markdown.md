# SDRplay IQ to AM demodulation for WWV reception

The SDRplay API delivers IQ samples through a stream callback function `sdrplay_api_StreamCallback_t` that provides **separate 16-bit signed integer arrays** (`short *xi`, `short *xq`) along with a sample count, making the data immediately accessible for DSP processing. AM demodulation from IQ is fundamentally an envelope detection problem: compute the **magnitude** of each complex sample using `√(I² + Q²)`, which recovers the instantaneous amplitude that carries the audio information.

The complete DSP pipeline requires three additional steps after magnitude calculation. First, apply a **lowpass anti-aliasing filter** with cutoff at half your target audio rate before decimation—this prevents high-frequency content from folding back into the audio band. Second, **decimate** by keeping every Nth sample to reduce the SDRplay's native MHz-range sample rate down to audio rates (typically 48 kHz); for a 2 MHz input targeting 48 kHz output, you'd decimate by roughly 42. Third, **remove the DC offset** that appears because the AM carrier becomes a constant bias after envelope detection—a simple first-order highpass IIR filter (`y[n] = x[n] - x[n-1] + 0.995·y[n-1]`) with cutoff around 30-50 Hz works well.

For WWV timing detection specifically, a **2.5 kHz audio bandwidth** captures all relevant content including the 100 Hz BCD time code subcarrier and the 1000 Hz second ticks. The SDRplay API documentation (v3.15 PDF at sdrplay.com/docs) and the official examples at github.com/SDRplay/examples provide working callback implementations, while the KE7KUS/WWV-Decoder project on GitHub demonstrates a complete GNU Radio-based WWV decoding chain if you want a reference architecture.